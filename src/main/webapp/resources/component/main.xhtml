<!DOCTYPE html>

<!--
/**
 * (c) Copyright i4 Software Ltd. All Rights Reserved.
 *
 * @author David Barton
 * @since May 2015
 */
 -->
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:composite="http://java.sun.com/jsf/composite"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pp="http://java.sun.com/jsf/composite/component"
      xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:f="http://java.sun.com/jsf/core">

<composite:interface componentType="main">
    <composite:attribute name="rootLocations" required="true" type="java.util.ArrayList"/>
    <composite:attribute name="factTypes" required="true" type="uk.co.i4software.poppie.census.FactType[]"/>
</composite:interface>

<composite:implementation>

    <p:layout fullPage="true">

        <p:layoutUnit id="westLayoutUnit" position="west" collapsible="true" resizable="true"
                      size="260" minSize="200">

            <f:facet name="header">
                <img src="${pageContext.request.contextPath}/resources/images/3d-pie-chart-icon/pie-chart-128.png"
                     title="Population Pie!" class="pp-settingsIcon"/>Locations
            </f:facet>
            <h:form>
                <p:tree value="#{cc.mainModel.locationTree}" var="node" selectionMode="multiple"
                        selection="#{cc.mainModel.selectedTreeNodes}" styleClass="pp-tree">

                    <p:ajax event="select" listener="#{cc.onLocationsSelect}" update="@([id$=population])"
                            onstart="PF('treeBlocker').show();" oncomplete="PF('treeBlocker').hide();"/>
                    <p:ajax event="unselect" listener="#{cc.onLocationsSelect}" update="@([id$=population])"
                            onstart="PF('treeBlocker').show();" oncomplete="PF('treeBlocker').hide();"/>

                    <p:treeNode><h:outputText value="#{node}"/></p:treeNode>

                </p:tree>
            </h:form>
            <p:blockUI block="westLayoutUnit" widgetVar="treeBlocker"/>
        </p:layoutUnit>

        <p:layoutUnit position="center">
            <p:accordionPanel dynamic="true" multiple="true" activeIndex="0" styleClass="pp-accordionPanel">
                <c:forEach items="#{cc.attrs.factTypes}" var="factType">
                    <p:tab title="#{factType.displayName}">
                        <p:outputPanel id="#{factType}-population">
                            <pp:population locations="#{cc.mainModel.selectedLocations}"
                                           factNames="#{factType.factNames}"/>
                        </p:outputPanel>
                    </p:tab>
                </c:forEach>
            </p:accordionPanel>
        </p:layoutUnit>

        <p:layoutUnit position="south" styleClass="pp-southLayoutUnit">
            <ui:include src="footer.xhtml"/>
        </p:layoutUnit>
    </p:layout>

</composite:implementation>

</html>